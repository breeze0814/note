import{M as V,T as b,g as L,F as _,h as M,O as C,a as I,b as g,s as T,c as q,d as B}from"./index.12ca6c9f.js";import{bD as p,bE as e,bT as c,bz as y,bs as h,br as w,bU as U,bo as E,bY as P,by as x,bw as $,bL as K}from"./vendor.677f7c0c.js";import{i as Y}from"./echarts.a99fb505.js";import{O as N,T as z}from"./vant.db335bb7.js";import"./mock.598c5236.js";const G="_wrapper_1fjyk_1",R="_topItem_1fjyk_5",W="_sign_1fjyk_11",X="_bar_wrapper_1fjyk_22",H="_bar_text_1fjyk_27",J="_bar_1fjyk_22",Q="_bar_inner_1fjyk_41",d={wrapper:G,topItem:R,sign:W,bar_wrapper:X,bar_text:H,bar:J,bar_inner:Q},Z=p({props:{data:{type:Array}},setup:(t,u)=>()=>e("div",{class:d.wrapper},[t.data&&t.data.length>0?t.data.map(({tag:n,amount:a,percent:r})=>e("div",{class:d.topItem},[e("div",{class:d.sign},[n.sign]),e("div",{class:d.bar_wrapper},[e("div",{class:d.bar_text},[e("span",null,[" ",n.name,c(" - "),r,c("%")," "]),e("span",null,[" ",c("\uFFE5"),e(V,{value:a},null)," "])]),e("div",{class:d.bar},[e("div",{class:d.bar_inner,style:{width:`${r}%`}},null)])])])):e("div",null,[c("\u6CA1\u6709\u6570\u636E")])])}),ee="_wrapper_hviyo_1",te="_peichart_hviyo_5",j={wrapper:ee,peichart:te},ae="_wrapper_wxcjg_1",ne={wrapper:ae},re={tooltip:{show:!0,trigger:"axis",formatter:([t])=>{const[u,n]=t.data;return`${new b(new Date(u)).format("YYYY\u5E74MM\u6708DD\u65E5")} \uFFE5${L(n)}`}},grid:[{left:16,top:20,right:16,bottom:20}],xAxis:{type:"time",boundaryGap:["3%","0%"],axisLabel:{formatter:t=>new b(new Date(t)).format("MM-DD")},axisTick:{alignWithLabel:!0}},yAxis:{show:!0,type:"value",splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{show:!1}}},se=p({props:{data:{type:Array,required:!0}},setup:(t,u)=>{const n=y();let a;return h(()=>{n.value!==void 0&&(a=Y(n.value),a.setOption({...re,series:[{data:t.data,type:"line"}]}))}),w(()=>t.data,()=>{a==null||a.setOption({series:[{data:t.data}]})}),()=>e("div",{ref:n,class:ne.wrapper},null)}}),oe="_wrapper_10bgc_1",le={wrapper:oe},ue={tooltip:{trigger:"item",formatter:t=>{const{name:u,value:n,percent:a}=t;return`${u}: \uFFE5${L(n)} \u5360\u6BD4 ${a}%`}},grid:[{left:0,top:0,right:0,bottom:0}],series:[{type:"pie",radius:"70%",emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},ie=p({props:{data:{type:Array}},setup:(t,u)=>{const n=y();let a;return h(()=>{n.value!==void 0&&(a=Y(n.value),a.setOption(ue))}),w(()=>t.data,()=>{a==null||a.setOption({series:[{data:t.data}]})}),()=>e("div",{ref:n,class:le.wrapper},null)}}),de=U("kind",{state:()=>({kind:"expenses"}),actions:{setKind(){E(()=>{localStorage.setItem("kind",this.kind)})}}}),ce=24*3600*1e3,pe=p({props:{startDate:{type:String,required:!1},endDate:{type:String,required:!1}},setup:(t,u)=>{const n=de(),{kind:a}=P(n),r=y([]),m=x(()=>{if(!t.startDate||!t.endDate)return[];const f=(new Date(t.endDate).getTime()-new Date(t.startDate).getTime())/ce+1;return Array.from({length:f}).map((O,A)=>{const S=new b(t.startDate+"T00:00:00.000+0800").add(A,"day").getTimestamp(),k=r.value[0],F=k&&new Date(k.happen_at+"T00:00:00.000+0800").getTime()===S?r.value.shift().amount:0;return[new Date(S).toISOString(),F]})}),i=async()=>{const o=await M.get("/items/summary",{happen_after:t.startDate,happen_before:t.endDate,kind:a.value,group_by:"happen_at"},{_mock:"itemSummary",_autoLoading:!0});r.value=o.data.groups};h(i),w(()=>a.value,i);const l=y([]),D=x(()=>l.value.map(o=>({name:o.tag.name,value:o.amount}))),v=async()=>{const o=await M.get("/items/summary",{happen_after:t.startDate,happen_before:t.endDate,kind:a.value,group_by:"tag_id"},{_mock:"itemSummary"});l.value=o.data.groups};h(v),w(()=>a.value,v);const s=x(()=>{const o=l.value.reduce((f,O)=>f+O.amount,0);return l.value.map(f=>({...f,percent:Math.round(f.amount/o*100)}))});return()=>e("div",{class:j.wrapper},[e(_,{label:"\u7C7B\u578B",type:"select",options:[{value:"expenses",text:"\u652F\u51FA"},{value:"income",text:"\u6536\u5165"}],modelValue:a.value,"onUpdate:modelValue":o=>a.value=o},null),e(se,{data:m.value,class:j.piechart},null),e(ie,{data:D.value},null),e(Z,{data:s.value},null)])}});p({props:{startDate:{type:String,required:!1},endDate:{type:String,required:!1}}});const me=p({props:{component:{type:Object,required:!0},rerenderOnSwitchTab:{type:Boolean,default:!1},hideThisYear:{type:Boolean,default:!1}},setup:(t,u)=>{const n=y("\u672C\u6708"),a=new b,r=$({start:new b().format(),end:new b().format()}),m=$({}),i=[{start:a.firstDayOfMonth(),end:a.lastDayOfMonth()},{start:a.add(-1,"month").firstDayOfMonth(),end:a.add(-1,"month").lastDayOfMonth()},{start:a.firstDayOfYear(),end:a.lastDayOfYear()}],l=y(!1),D=s=>{if(s.preventDefault(),l.value=!1,Object.assign(m,r),new Date(r.start).getTime()>new Date(r.end).getTime())return z(`\u5F00\u59CB\u65F6\u95F4\u5927\u4E8E\u7ED3\u675F\u65F6\u95F4
\u8BF7\u91CD\u65B0\u9009\u62E9\u65F6\u95F4`);l.value=!1,Object.assign(m,r)},v=s=>{s==="\u81EA\u5B9A\u4E49\u65F6\u95F4"&&(l.value=!0)};return()=>e(B,null,{title:()=>"\u7EDF\u8BA1\u6570\u636E",icon:()=>e(C,null,null),default:()=>e(K,null,[e(I,{classPrefix:"customTabs",selected:n.value,"onUpdate:selected":[s=>n.value=s,v],rerenderOnSelect:t.rerenderOnSwitchTab},{default:()=>[e(g,{value:"\u672C\u6708",name:"\u672C\u6708"},{default:()=>[e(t.component,{startDate:i[0].start.format(),endDate:i[0].end.format()},null)]}),e(g,{value:"\u4E0A\u6708",name:"\u4E0A\u6708"},{default:()=>[e(t.component,{startDate:i[1].start.format(),endDate:i[1].end.format()},null)]}),e(g,{value:"\u81EA\u5B9A\u4E49\u65F6\u95F4",name:"\u81EA\u5B9A\u4E49\u65F6\u95F4"},{default:()=>[e(t.component,{startDate:m.start,endDate:m.end},null)]})]}),e(N,{show:l.value,class:T.overlay},{default:()=>[e("div",{class:T.overlay_inner},[e("header",null,[c("\u8BF7\u9009\u62E9\u65F6\u95F4")]),e("main",null,[e(q,{onSubmit:D},{default:()=>[e(_,{label:"\u5F00\u59CB\u65F6\u95F4",modelValue:r.start,"onUpdate:modelValue":s=>r.start=s,type:"date"},null),e(_,{label:"\u7ED3\u675F\u65F6\u95F4",modelValue:r.end,"onUpdate:modelValue":s=>r.end=s,type:"date"},null),e(_,null,{default:()=>[e("div",{class:T.actions},[e("button",{type:"button",onClick:()=>l.value=!1},[c("\u53D6\u6D88")]),e("button",{type:"submit"},[c("\u786E\u8BA4")])])]})]})])])]})])})}}),he=p({setup:(t,u)=>()=>e(me,{rerenderOnSwitchTab:!0,component:pe,hideThisYear:!0},null)});export{he as StatisticsPage,he as default};
